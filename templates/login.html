<html lang="en">
<body>

<h2>Add User</h2>

<form id="addUserForm">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required><br>

    <label for="uid">User ID:</label>
    <input type="text" id="uid" name="uid" required><br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required><br>

    <label for="dob">Date of Birth (MM-DD-YYYY):</label>
    <input type="text" id="dob" name="dob"><br>

    <button type="button" onclick="addUser()">Add User</button>
</form>

<script>
    function authenticateUser() {
        var credentials = {
            uid: 'your_user_id',
            password: 'your_password'
        };

        fetch('/api/users/authenticate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(credentials)
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                // Successfully authenticated, now add user with the obtained token
                addUser(data.token);
            } else {
                console.error('Authentication failed:', data.message);
                alert('Authentication failed. Please check the console for details.');
            }
        })
        .catch(error => {
            console.error('Error authenticating user:', error);
            alert('Error authenticating user. Please check the console for details.');
        });
    }

    function addUser(token) {
        var formData = {
            name: document.getElementById('name').value,
            uid: document.getElementById('uid').value,
            password: document.getElementById('password').value,
            dob: document.getElementById('dob').value
        };

        fetch('/api/users/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token  // Include the obtained token in the headers
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            alert('User added successfully!');
            // You can redirect or perform any other action here after successful user addition
        })
        .catch(error => {
            console.error('Error adding user:', error);
            alert('Error adding user. Please check the console for details.');
        });
    }

    // Call authenticateUser() to start the process
    authenticateUser();
</script>


</body>
</html>